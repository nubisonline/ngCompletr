/*
 * ngCompletr 0.0.1
 * 
 *
 * Built on 23-07-2014
 *
 * Licensed under the MIT license
 */
"use strict";!function(a,b){b.module("ngCompletr",[]).run(["$templateCache",function(a){a.put("ngCompletr.html",'<div class="ng-completr-holder"><span ng-transclude></span><div class="ng-completr-dropdown" ng-if="showDropdown"><div class="ng-completr-searching" ng-show="searching">Searching...</div><div class="ng-completr-no-results" ng-show="!searching && (!results || results.length == 0)">No results found</div><div class="ng-completr-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseover="hoverRow()" ng-class="{\'ng-completr-selected-row\': $index == currentIndex}"><div ng-if="showImage" class="ng-completr-image-holder"><img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="ng-completr-image"/><div ng-if="!result.image && result.image != \'\'" class="ng-completr-image-default"></div></div><div class="ng-completr-title" ng-if="matchClass" ng-bind-html="result.title"></div><div class="ng-completr-title" ng-if="!matchClass">{{ result.title }}</div><div ng-if="result.description && result.description != \'\'" class="ng-completr-description">{{result.description}}</div></div></div></div>')}]).directive("ngCompletr",["$timeout","$http","$compile",function(a,c,d){return{restrict:"EA",replace:!0,transclude:!0,scope:{query:"=ngCompletrQuery",selectedObject:"=ngCompletrResult",selectedCallback:"=ngCompletrResultCallback",source:"=ngCompletrSource",searchOptions:"=ngCompletrSearch",displayOptions:"=ngCompletrDisplay"},templateUrl:"ngCompletr.html",link:function(e,f){var g,h,i,j,k,l,m,n={down:40,up:38,"return":13,esc:27,backspace:8};e.searchOptions?(h=e.searchOptions.delay?e.searchOptions.delay:100,g=e.searchOptions.minLength?e.searchOptions.minLength:3,l=e.searchOptions.data,m=e.searchOptions.fields):(h=100,g=3,l=null,m=[]),e.displayOptions?(i=e.displayOptions.title,j=e.displayOptions.description,k=e.displayOptions.image):(i=[],j=null,k=null),e.showImage=k?!0:!1,e.inputElement=f.find("input"),e.inputElement.attr("ng-model","query"),d(e.inputElement)(e),e.showDropdown=!1,e.searching=!1,e.lastSearchTerm=null,e.results=[],e.currentIndex=null,e.searchTimer=null;var o=function(a,b){return a.length>=g&&a!==b};e.selectResult=function(a){e.query=e.lastSearchTerm=a.title,e.selectedObject=a,b.isFunction(e.selectedCallback)&&e.selectedCallback(a),e.showDropdown=!1,e.results=[]},e.hoverRow=function(a){e.currentIndex=a},e.processResults=function(a){if(a&&a.length>0){e.results=[];for(var c=0;c<a.length;c++){var d="",f="",g="";if(b.isString(a[c]))d=a[c];else{for(var h=[],l=0;l<i.length;l++)h.push(a[c][i[l]]);j&&(f=a[c][j]),k&&(g=a[c][k]),d=h.join(" ")}var m={title:d,description:f,image:g,originalObject:a[c]};e.results[e.results.length]=m}}else e.results=[]},e.searchTimerComplete=function(a){if(b.isArray(e.source)){for(var d=[],f=0;f<e.source.length;f++){var g=!1;if(b.isString(e.source[f]))g=e.source[f].toLowerCase().indexOf(a.toLowerCase())>=0;else for(var h=0;h<m.length;h++)g=g||e.source[f][m[h]].toLowerCase().indexOf(a.toLowerCase())>=0;g&&(d[d.length]=e.source[f])}e.searching=!1,e.processResults(d,a)}b.isFunction(e.source)&&e.source(a,function(b){e.searching=!1,e.processResults(b,a)}),b.isString(e.source)&&c.get(e.source+a,{}).success(function(b){e.searching=!1,e.processResults(b[l],a)}).error(function(){e.searching=!1})},e.keyPressed=function(b){b.which!==n.up&&b.which!==n.down&&b.which!==n.return?e.query&&""!==e.query?o(e.query,e.lastSearchTerm)&&(e.lastSearchTerm=e.query,e.showDropdown=!0,e.currentIndex=-1,e.results=[],e.searchTimer&&a.cancel(e.searchTimer),e.searching=!0,e.searchTimer=a(function(){e.searchTimerComplete(e.query)},h)):(e.showDropdown=!1,e.lastSearchTerm=null):b.preventDefault()},e.inputElement.on("keyup",e.keyPressed),f.on("keyup",function(a){a.which===n.down?(e.currentIndex+1<e.results.length&&(e.currentIndex++,e.$apply(),a.preventDefault(),a.stopPropagation()),e.$apply()):a.which===n.up?e.currentIndex>=1&&(e.currentIndex--,e.$apply(),a.preventDefault(),a.stopPropagation()):a.which===n.return?e.currentIndex>=0&&e.currentIndex<e.results.length?(e.selectResult(e.results[e.currentIndex]),e.$apply(),a.preventDefault(),a.stopPropagation()):e.results.length?(e.hoverRow(0),e.selectResult(e.results[e.currentIndex]),e.$apply(),a.preventDefault(),a.stopPropagation()):(e.results=[],e.$apply()):a.which===n.esc?(e.results=[],e.showDropdown=!1,e.$apply()):a.which===n.backspace&&(e.selectedObject=null,e.$apply())})}}}])}(window,window.angular);