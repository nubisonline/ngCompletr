/*
 * ngCompletr 1.0.0
 * http://demotix.com
 *
 * Built on 03-03-2014
 *
 * Licensed under the MIT license
 */
"use strict";!function(a,b){b.module("ngCompletr",[]).run(["$templateCache",function(a){a.put("ngCompletr.html",'<div class="ng-completr-holder"><span ng-transclude></span><div class="ng-completr-dropdown" ng-if="showDropdown"><div class="ng-completr-searching" ng-show="searching">Searching...</div><div class="ng-completr-no-results" ng-show="!searching && (!results || results.length == 0)">No results found</div><div class="ng-completr-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseover="hoverRow()" ng-class="{\'ng-completr-selected-row\': $index == currentIndex}"><div ng-if="imageField" class="ng-completr-image-holder"><img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="ng-completr-image"/><div ng-if="!result.image && result.image != \'\'" class="ng-completr-image-default"></div></div><div class="ng-completr-title" ng-if="matchClass" ng-bind-html="result.title"></div><div class="ng-completr-title" ng-if="!matchClass">{{ result.title }}</div><div ng-if="result.description && result.description != \'\'" class="ng-completr-description">{{result.description}}</div></div></div></div>')}]).directive("ngCompletr",["$timeout","$http","$compile",function(a,c,d){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@id",query:"=ngCompletrQuery",source:"=ngCompletrSource",delay:"@ngCompletrDelay",minLength:"@ngCompletrMinLength",searchFields:"@ngCompletrSearchFields",dataField:"@ngCompletrDataField",titleField:"@ngCompletrTitleField",descriptionField:"@ngCompletrDescriptionField",imageField:"@ngCompletrImageField",selectedObject:"=ngCompletrResult",selectedCallback:"=ngCompletrResultCallback"},templateUrl:"ngCompletr.html",link:function(e,f){var g,h,i={down:40,up:38,"return":13,esc:27,backspace:8};e.inputElement=f.find("input"),e.inputElement.attr("ng-model","query"),d(e.inputElement)(e),e.minLength&&(e.minLength=parseInt(e.minLength,10)),g=e.minLength?e.minLength:3,e.delay&&(e.delay=parseInt(e.delay,10)),h=e.delay?e.delay:100,e.showDropdown=!1,e.searching=!1,e.lastSearchTerm=null,e.results=[],e.currentIndex=null,e.searchTimer=null;var j=function(a,b){return a.length>=g&&a!==b};e.selectResult=function(a){e.query=e.lastSearchTerm=a.title,e.selectedObject=a,b.isFunction(e.selectedCallback)&&e.selectedCallback(a),e.showDropdown=!1,e.results=[]},e.hoverRow=function(a){e.currentIndex=a},e.processResults=function(a){if(a&&a.length>0){e.results=[];var c=[];e.titleField&&""!==e.titleField&&(c=e.titleField.split(","));for(var d=0;d<a.length;d++){var f="",g="",h="";if(b.isString(a[d]))f=a[d];else{for(var i=[],j=0;j<c.length;j++)i.push(a[d][c[j]]);e.descriptionField&&(g=a[d][e.descriptionField]),e.imageField&&(h=a[d][e.imageField]),f=i.join(" ")}var k={title:f,description:g,image:h,originalObject:a[d]};e.results[e.results.length]=k}}else e.results=[]},e.searchTimerComplete=function(a){if(b.isArray(e.source)){for(var d=e.searchFields.split(","),f=[],g=0;g<e.source.length;g++){var h=!1;if(b.isString(e.source[g]))h=e.source[g].toLowerCase().indexOf(a.toLowerCase())>=0;else for(var i=0;i<d.length;i++)h=h||e.source[g][d[i]].toLowerCase().indexOf(a.toLowerCase())>=0;h&&(f[f.length]=e.source[g])}e.searching=!1,e.processResults(f,a)}b.isFunction(e.source),b.isString(e.source)&&c.get(e.source+a,{}).success(function(b){e.searching=!1,e.processResults(b[e.dataField],a)}).error(function(){e.searching=!1,console.log("error")})},e.keyPressed=function(b){b.which!==i.up&&b.which!==i.down&&b.which!==i.return?e.query&&""!==e.query?j(e.query,e.lastSearchTerm)&&(e.lastSearchTerm=e.query,e.showDropdown=!0,e.currentIndex=-1,e.results=[],e.searchTimer&&a.cancel(e.searchTimer),e.searching=!0,e.searchTimer=a(function(){e.searchTimerComplete(e.query)},h)):(e.showDropdown=!1,e.lastSearchTerm=null):b.preventDefault()},e.inputElement.on("keyup",e.keyPressed),f.on("keyup",function(a){a.which===i.down?(e.currentIndex+1<e.results.length&&(e.currentIndex++,e.$apply(),a.preventDefault(),a.stopPropagation()),e.$apply()):a.which===i.up?e.currentIndex>=1&&(e.currentIndex--,e.$apply(),a.preventDefault(),a.stopPropagation()):a.which===i.return?e.currentIndex>=0&&e.currentIndex<e.results.length?(e.selectResult(e.results[e.currentIndex]),e.$apply(),a.preventDefault(),a.stopPropagation()):(e.results=[],e.$apply(),a.preventDefault(),a.stopPropagation()):a.which===i.esc?(e.results=[],e.showDropdown=!1,e.$apply()):a.which===i.backspace&&(e.selectedObject=null,e.$apply())})}}}])}(window,window.angular);